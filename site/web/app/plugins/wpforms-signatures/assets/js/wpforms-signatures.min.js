var WPFormsSignatures=window.WPFormsSignatures||function(c,t,e){"use strict";var r={config:{windowWidth:!1,pixelRatio:Math.max(t.devicePixelRatio||1,1),watching:!1,watchingRate:300},signatures:{},signaturesDisabled:[],getCanvas:function(t){t=t.get(0);return t.width=t.offsetWidth*r.config.pixelRatio,t.height=t.offsetHeight*r.config.pixelRatio,t.getContext("2d").scale(r.config.pixelRatio,r.config.pixelRatio),t},cropCanvas:function(t){var i=c.createElement("canvas"),n=i.getContext("2d");i.width=t.width,i.height=t.height,n.drawImage(t,0,0);for(var e,a,r=i.width,s=i.height,g={x:[],y:[]},o=n.getImageData(0,0,i.width,i.height),u=0;u<s;u++)for(e=0;e<r;e++)a=4*(u*r+e),0<o.data[3+a]&&(g.x.push(e),g.y.push(u));return g.x.sort(function(t,i){return t-i}),g.y.sort(function(t,i){return t-i}),t=g.x.length-1,r=g.x[t]-g.x[0],s=g.y[t]-g.y[0],t=n.getImageData(g.x[0],g.y[0],r,s),i.width=r,i.height=s,n.putImageData(t,0,0),i.toDataURL()},watchSignatures:function(){if(r.signaturesDisabled.length<1)return clearInterval(r.config.watching),void(r.config.watching=!1);for(var t in r.signaturesDisabled){var i=e("#"+r.signaturesDisabled[t]);i.is(":hidden")||(r.signaturesDisabled.splice(t,1),n.loadSignature(i))}}},n={init:function(){e(c).on("wpformsReady",n.ready)},ready:function(){r.config.windowWidth=e(t).width(),n.loadSignatures(),e(c).on("click",".wpforms-signature-clear",function(t){t.preventDefault(),n.resetSignature(e(this).parent().find(".wpforms-signature-canvas"))}),e(t).resize(n.resetSignatures),0<r.signaturesDisabled.length&&(r.config.watching=setInterval(r.watchSignatures,r.config.watchingRate))},loadSignatures:function(){e(".wpforms-signature-canvas").each(function(){n.loadSignature(e(this))})},loadSignature:function(t){var i=t.closest(".wpforms-field-signature").find(".wpforms-signature-input"),n=t.attr("id"),e=r.getCanvas(t),a=t.data("color");t.is(":hidden")?r.signaturesDisabled.push(n):r.signatures[n]=new SignaturePad(e,{penColor:a,onEnd:function(){i.val(r.cropCanvas(e)).trigger("input change").valid()}})},resetSignatures:function(){r.config.windowWidth!==e(t).width()&&e(".wpforms-signature-canvas").each(function(){n.resetSignature(e(this))})},resetSignature:function(t){var i=t.closest(".wpforms-field-signature").find(".wpforms-signature-input"),n=t.attr("id");r.getCanvas(t),r.signatures[n]&&r.signatures[n].clear(),i.val("").trigger("input change"),t.is(":hidden")&&(-1===e.inArray(n,r.signaturesDisabled)&&r.signaturesDisabled.push(n),r.signatures[n]&&delete r.signatures[n],r.config.watching||(r.config.watching=setInterval(r.watchSignatures,r.config.watchingRate)))}};return n}(document,window,jQuery);WPFormsSignatures.init();